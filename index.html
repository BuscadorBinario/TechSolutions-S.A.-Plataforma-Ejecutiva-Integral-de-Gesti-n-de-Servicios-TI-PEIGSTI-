<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PEIGSTI - TechSolutions S.A. | Dashboard Ejecutivo ISO 20000</title>
    <style>
        :root {
            --primary-dark: #0a2647;
            --primary-mid: #144272;
            --primary-light: #2a6fdf;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --bg-main: #f5f7fa;
            --bg-card: #ffffff;
            --text-main: #2c3e50;
            --text-secondary: #7f8c8d;
            --border: #e1e8ed;
            --shadow: rgba(0,0,0,0.08);
            --shadow-hover: rgba(0,0,0,0.15);
        }

        [data-theme="dark"] {
            --bg-main: #1a1a2e;
            --bg-card: #16213e;
            --text-main: #eee;
            --text-secondary: #bbb;
            --border: #2a3f5f;
            --shadow: rgba(0,0,0,0.3);
            --shadow-hover: rgba(0,0,0,0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        #loadingScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-mid) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loadingScreen h2 {
            margin-top: 20px;
            font-size: 1.5rem;
        }

        header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-mid) 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .logo-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--warning);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .title-block h1 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .title-block p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .header-info {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .info-label {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .container {
            max-width: 1800px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .tabs-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--border);
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(42, 111, 223, 0.1);
            color: var(--primary-light);
        }

        .tab.active {
            background: var(--primary-light);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-light);
            transition: width 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px var(--shadow-hover);
        }

        .kpi-card:hover::before {
            width: 100%;
            opacity: 0.05;
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .kpi-icon {
            font-size: 2rem;
            opacity: 0.8;
        }

        .kpi-trend {
            font-size: 1.2rem;
        }

        .kpi-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        [data-theme="dark"] .kpi-value {
            color: var(--primary-light);
        }

        .kpi-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .kpi-sparkline {
            width: 100%;
            height: 40px;
            margin-top: 0.5rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small:hover {
            background: var(--primary-mid);
            transform: scale(1.05);
        }

        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        [data-theme="dark"] .section-title {
            color: var(--primary-light);
        }

        .section-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-mid);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-success { background: var(--success); }
        .btn-warning { background: var(--warning); }
        .btn-danger { background: var(--danger); }
        .btn-info { background: var(--info); }

        .alert-banner {
            background: linear-gradient(135deg, var(--warning) 0%, #f57c00 100%);
            color: white;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px var(--shadow);
            animation: slideDown 0.5s;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .chart-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .chart-canvas {
            width: 100%;
            max-height: 400px;
            border-radius: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--danger);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .modal-close:hover {
            transform: rotate(90deg);
            background: #d32f2f;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
        }

        thead {
            background: var(--primary-dark);
            color: white;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        tbody tr {
            transition: background 0.3s;
            cursor: pointer;
        }

        tbody tr:hover {
            background: rgba(42, 111, 223, 0.05);
        }

        .priority-critical { color: var(--danger); font-weight: 600; }
        .priority-high { color: var(--warning); font-weight: 600; }
        .priority-medium { color: var(--primary-light); font-weight: 600; }
        .priority-low { color: var(--success); font-weight: 600; }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-online { background: #e8f5e9; color: #2e7d32; }
        .status-warning { background: #fff3e0; color: #e65100; }
        .status-offline { background: #ffebee; color: #c62828; }

        [data-theme="dark"] .status-online { background: #1b5e20; color: #a5d6a7; }
        [data-theme="dark"] .status-warning { background: #e65100; color: #ffcc80; }
        [data-theme="dark"] .status-offline { background: #b71c1c; color: #ef9a9a; }

        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-main);
            color: var(--text-main);
            font-size: 0.9rem;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary-light);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-mid));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.5rem;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-light);
            border: 3px solid var(--bg-card);
        }

        .timeline-content {
            background: var(--bg-main);
            padding: 1rem;
            border-radius: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-main);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--primary-light));
            transition: width 0.5s ease;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .section {
                padding: 1rem;
            }

            .container {
                padding: 0 1rem;
            }
        }

        .text-center { text-align: center; }
        .mt-1 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .mb-2 { margin-bottom: 2rem; }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <div class="loader"></div>
        <h2>Cargando Dashboard Ejecutivo ISO 20000...</h2>
        <p>TechSolutions S.A.</p>
    </div>

    <header>
        <div class="header-content">
            <div class="logo-title">
                <div class="logo">TS</div>
                <div class="title-block">
                    <h1>TechSolutions S.A. ‚Äì PEIGSTI</h1>
                    <p>ISO/IEC 20000-1:2018 | Dashboard Ejecutivo en Tiempo Real</p>
                </div>
            </div>
            <div class="header-info">
                <div class="info-item">
                    <span class="info-label">Fecha y Hora</span>
                    <span class="info-value" id="currentDateTime">--</span>
                </div>
                <div class="info-item">
                    <span class="info-label">√öltima Actualizaci√≥n</span>
                    <span class="info-value" id="lastUpdate">Hace 0s</span>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">üåì</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="alert-banner" id="alertBanner">
            <div class="alert-content">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <div>
                    <strong id="alertTitle">Alerta Activa:</strong>
                    <span id="alertMessage">Sistema funcionando correctamente</span>
                </div>
            </div>
            <div>
                <button class="btn-small" onclick="dismissAlert()">Marcar le√≠do</button>
            </div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">üìä Visi√≥n General</button>
                <button class="tab" onclick="switchTab('incidents')">üö® Incidentes</button>
                <button class="tab" onclick="switchTab('services')">üîß Servicios TI</button>
                <button class="tab" onclick="switchTab('changes')">üîÑ Gesti√≥n de Cambios</button>
                <button class="tab" onclick="switchTab('problems')">üîç Problemas</button>
                <button class="tab" onclick="switchTab('capacity')">üìà Capacidad</button>
                <button class="tab" onclick="switchTab('reports')">üìã Reportes</button>
            </div>

            <div class="tab-content active" id="overview">
                <h2 style="margin: 2rem 0 1rem;">Panel de KPIs Ejecutivos</h2>
                <div class="kpi-grid" id="kpiGrid"></div>

                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üìä An√°lisis de Rendimiento</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                        <div>
                            <h4 class="text-center mb-1">Distribuci√≥n de Incidentes por Prioridad</h4>
                            <canvas id="donutChart" width="400" height="400"></canvas>
                        </div>
                        <div>
                            <h4 class="text-center mb-1">Tendencia Mensual de Incidentes</h4>
                            <canvas id="lineChart" width="400" height="400"></canvas>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">‚è±Ô∏è Actividad Reciente</h3>
                    </div>
                    <div class="timeline" id="activityTimeline"></div>
                </div>
            </div>

            <div class="tab-content" id="incidents">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üö® Gesti√≥n de Incidentes</h3>
                        <div class="section-actions">
                            <button class="btn btn-success" onclick="openNewIncidentModal()">‚ûï Nuevo Incidente</button>
                            <button class="btn btn-info" onclick="refreshIncidents()">üîÑ Actualizar</button>
                            <button class="btn" onclick="exportData('incidents')">üì• Exportar</button>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <input type="text" class="filter-input" placeholder="üîç Buscar incidentes..." onkeyup="filterTable('incidentsTable', this.value)">
                        <select class="filter-input" onchange="filterByPriority(this.value)">
                            <option value="">Todas las prioridades</option>
                            <option value="critical">Cr√≠tico</option>
                            <option value="high">Alto</option>
                            <option value="medium">Medio</option>
                            <option value="low">Bajo</option>
                        </select>
                        <select class="filter-input" onchange="filterByStatus(this.value)">
                            <option value="">Todos los estados</option>
                            <option value="Abierto">Abierto</option>
                            <option value="En Progreso">En Progreso</option>
                            <option value="Resuelto">Resuelto</option>
                        </select>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalIncidents">0</div>
                            <div class="stat-label">Total Incidentes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="openIncidents">0</div>
                            <div class="stat-label">Abiertos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="criticalIncidents">0</div>
                            <div class="stat-label">Cr√≠ticos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgResolutionTime">0h</div>
                            <div class="stat-label">Tiempo Promedio</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="incidentsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>T√≠tulo</th>
                                    <th>Prioridad</th>
                                    <th>Estado</th>
                                    <th>Servicio</th>
                                    <th>Asignado</th>
                                    <th>Fecha Apertura</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="incidentsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="services">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üîß Cat√°logo de Servicios TI</h3>
                        <button class="btn" onclick="refreshServices()">üîÑ Actualizar Estado</button>
                    </div>
                    <div id="serviceMap" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;"></div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üìä Monitoreo de SLA</h3>
                    </div>
                    <div id="slaMonitoring"></div>
                </div>
            </div>

            <div class="tab-content" id="changes">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üîÑ Gesti√≥n de Cambios</h3>
                        <button class="btn btn-success" onclick="openNewChangeModal()">‚ûï Solicitar Cambio</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Descripci√≥n</th>
                                    <th>Tipo</th>
                                    <th>Impacto</th>
                                    <th>Estado</th>
                                    <th>Fecha Planificada</th>
                                    <th>Solicitante</th>
                                </tr>
                            </thead>
                            <tbody id="changesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="problems">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üîç Gesti√≥n de Problemas</h3>
                        <button class="btn btn-warning" onclick="openNewProblemModal()">‚ûï Registrar Problema</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Descripci√≥n</th>
                                    <th>Categor√≠a</th>
                                    <th>Severidad</th>
                                    <th>Incidentes Relacionados</th>
                                    <th>Estado</th>
                                    <th>Asignado</th>
                                </tr>
                            </thead>
                            <tbody id="problemsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="capacity">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üìà Gesti√≥n de Capacidad</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;" id="capacityMetrics"></div>
                </div>

                <div class="section mt-2">
                    <h3 class="section-title mb-1">üìä Uso de Recursos en Tiempo Real</h3>
                    <canvas id="capacityChart" width="800" height="300"></canvas>
                </div>
            </div>

            <div class="tab-content" id="reports">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üìã Centro de Reportes</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div class="kpi-card" onclick="generateReport('monthly')">
                            <div class="kpi-icon">üìä</div>
                            <div class="kpi-title">Reporte Mensual</div>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">Resumen completo del desempe√±o mensual</p>
                            <button class="btn btn-small mt-1">Generar</button>
                        </div>
                        <div class="kpi-card" onclick="generateReport('sla')">
                            <div class="kpi-icon">üìà</div>
                            <div class="kpi-title">Cumplimiento SLA</div>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">An√°lisis de acuerdos de nivel de servicio</p>
                            <button class="btn btn-small mt-1">Generar</button>
                        </div>
                        <div class="kpi-card" onclick="generateReport('incidents')">
                            <div class="kpi-icon">üö®</div>
                            <div class="kpi-title">An√°lisis de Incidentes</div>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">Estad√≠sticas detalladas de incidentes</p>
                            <button class="btn btn-small mt-1">Generar</button>
                        </div>
                        <div class="kpi-card" onclick="generateReport('availability')">
                            <div class="kpi-icon">‚úÖ</div>
                            <div class="kpi-title">Disponibilidad de Servicios</div>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">M√©tricas de uptime y downtime</p>
                            <button class="btn btn-small mt-1">Generar</button>
                        </div>
                        <div class="kpi-card" onclick="generateReport('changes')">
                            <div class="kpi-icon">üîÑ</div>
                            <div class="kpi-title">Gesti√≥n de Cambios</div>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">Reporte de cambios implementados</p>
                            <button class="btn btn-small mt-1">Generar</button>
                        </div>
                        <div class="kpi-card" onclick="generateReport('custom')">
                            <div class="kpi-icon">‚öôÔ∏è</div>
                            <div class="kpi-title">Reporte Personalizado</div>
                            <p style="margin-top: 1rem; color: var(--text-secondary);">Configura tu propio reporte</p>
                            <button class="btn btn-small mt-1">Configurar</button>
                        </div>
                    </div>
                </div>

                <div class="section mt-2">
                    <div class="section-header">
                        <h3 class="section-title">üìÅ Historial de Reportes Generados</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo de Reporte</th>
                                    <th>Periodo</th>
                                    <th>Generado Por</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="reportsHistoryBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="genericModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <h2 id="modalTitle">T√≠tulo del Modal</h2>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let updateInterval;
        let lastUpdateTime = Date.now();
        let dataStore = {
            kpis: [],
            incidents: [],
            services: [],
            changes: [],
            problems: [],
            capacity: [],
            activities: [],
            reports: []
        };

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                initializeDashboard();
            }, 1500);
        });

        function initializeDashboard() {
            updateDateTime();
            generateInitialData();
            renderAllComponents();
            startAutoUpdate();
            setInterval(updateDateTime, 1000);
            setInterval(updateLastUpdateIndicator, 1000);
        }

        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = 
                now.toLocaleDateString('es-ES', options);
        }

        function updateLastUpdateIndicator() {
            const seconds = Math.floor((Date.now() - lastUpdateTime) / 1000);
            document.getElementById('lastUpdate').textContent = `Hace ${seconds}s`;
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            html.setAttribute('data-theme', currentTheme === 'dark' ? '' : 'dark');
            setTimeout(() => {
                renderCharts();
                renderCapacityChart();
            }, 100);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'capacity') {
                setTimeout(() => renderCapacityChart(), 100);
            }
        }

        function generateInitialData() {
            dataStore.kpis = [
                { id: 1, title: 'Disponibilidad General', value: 99.7, unit: '%', trend: 'up', icon: 'üìä', target: 99.5 },
                { id: 2, title: 'Incidentes Abiertos', value: 23, unit: '', trend: 'down', icon: 'üö®', target: 20 },
                { id: 3, title: 'Cambios Pendientes', value: 12, unit: '', trend: 'neutral', icon: 'üîÑ', target: 15 },
                { id: 4, title: 'MTTR Promedio', value: 2.3, unit: 'h', trend: 'down', icon: '‚è±Ô∏è', target: 2.5 },
                { id: 5, title: 'Satisfacci√≥n Usuario', value: 4.6, unit: '/5', trend: 'up', icon: 'üòä', target: 4.5 },
                { id: 6, title: 'SLA Cumplimiento', value: 97.2, unit: '%', trend: 'up', icon: '‚úÖ', target: 95 },
                { id: 7, title: 'Problemas Activos', value: 5, unit: '', trend: 'neutral', icon: 'üîß', target: 8 },
                { id: 8, title: 'Riesgos Cr√≠ticos', value: 3, unit: '', trend: 'down', icon: '‚ö†Ô∏è', target: 5 },
                { id: 9, title: 'Tickets Resueltos Hoy', value: 45, unit: '', trend: 'up', icon: '‚úîÔ∏è', target: 40 },
                { id: 10, title: 'Tasa de Primera Resoluci√≥n', value: 78, unit: '%', trend: 'up', icon: 'üéØ', target: 75 },
                { id: 11, title: 'Llamadas en Cola', value: 8, unit: '', trend: 'neutral', icon: 'üìû', target: 10 },
                { id: 12, title: 'Uso CPU Promedio', value: 67, unit: '%', trend: 'up', icon: 'üíª', target: 80 }
            ];

            const incidentTitles = [
                'Falla en servidor de correo electr√≥nico',
                'Error de autenticaci√≥n en portal web',
                'P√©rdida de conectividad en red LAN',
                'Ralentizaci√≥n en aplicaci√≥n ERP',
                'Ca√≠da del servicio de base de datos',
                'Problema con impresoras de red',
                'Error en sistema de respaldo',
                'Fallo en aplicaci√≥n CRM',
                'Corrupci√≥n de archivos en servidor',
                'Problema de rendimiento en portal',
                'Error en actualizaci√≥n de software',
                'Falla en sistema de telefon√≠a IP',
                'Problema con VPN corporativa',
                'Error en sistema de gesti√≥n documental',
                'Fallo en servidor de aplicaciones'
            ];

            for (let i = 1; i <= 15; i++) {
                const openDate = new Date();
                openDate.setDate(openDate.getDate() - Math.floor(Math.random() * 10));
                dataStore.incidents.push({
                    id: `INC-${1000 + i}`,
                    title: incidentTitles[i - 1],
                    priority: getRandomItem(['critical', 'high', 'medium', 'low']),
                    status: getRandomItem(['Abierto', 'En Progreso', 'Resuelto', 'Cerrado']),
                    service: getRandomItem(['Email', 'ERP', 'CRM', 'Portal', 'Base de Datos', 'Red']),
                    assigned: getRandomItem(['Juan P√©rez', 'Ana Garc√≠a', 'Carlos L√≥pez', 'Mar√≠a Rodr√≠guez', 'Luis Mart√≠nez']),
                    openDate: openDate.toLocaleDateString('es-ES')
                });
            }

            dataStore.services = [
                { name: 'Correo Electr√≥nico', status: 'online', availability: 99.9, users: 450, responseTime: 120 },
                { name: 'ERP Corporativo', status: 'online', availability: 99.7, users: 320, responseTime: 350 },
                { name: 'CRM Ventas', status: 'online', availability: 99.8, users: 180, responseTime: 200 },
                { name: 'Portal Intranet', status: 'warning', availability: 98.2, users: 500, responseTime: 450 },
                { name: 'Base de Datos Principal', status: 'online', availability: 99.95, users: 280, responseTime: 50 },
                { name: 'Sistema de Respaldo', status: 'online', availability: 99.5, users: 0, responseTime: 80 },
                { name: 'VPN Corporativa', status: 'online', availability: 99.3, users: 150, responseTime: 180 },
                { name: 'Sistema Telefon√≠a IP', status: 'warning', availability: 97.8, users: 400, responseTime: 300 }
            ];

            for (let i = 1; i <= 10; i++) {
                const plannedDate = new Date();
                plannedDate.setDate(plannedDate.getDate() + Math.floor(Math.random() * 15));
                dataStore.changes.push({
                    id: `CHG-${2000 + i}`,
                    description: getRandomItem([
                        'Actualizaci√≥n de firmware en switches',
                        'Migraci√≥n de base de datos a nuevo servidor',
                        'Instalaci√≥n de parches de seguridad',
                        'Actualizaci√≥n de sistema operativo',
                        'Configuraci√≥n de nueva pol√≠tica de seguridad',
                        'Implementaci√≥n de nuevo m√≥dulo CRM'
                    ]),
                    type: getRandomItem(['Est√°ndar', 'Normal', 'Emergencia']),
                    impact: getRandomItem(['Alto', 'Medio', 'Bajo']),
                    status: getRandomItem(['Pendiente', 'Aprobado', 'En Implementaci√≥n', 'Completado']),
                    plannedDate: plannedDate.toLocaleDateString('es-ES'),
                    requester: getRandomItem(['Juan P√©rez', 'Ana Garc√≠a', 'Carlos L√≥pez'])
                });
            }

            for (let i = 1; i <= 8; i++) {
                dataStore.problems.push({
                    id: `PRB-${3000 + i}`,
                    description: getRandomItem([
                        'Degradaci√≥n peri√≥dica de rendimiento en servidor web',
                        'Reinicio autom√°tico de servicio de email',
                        'P√©rdida intermitente de paquetes en red',
                        'Sobrecarga de memoria en servidor aplicaciones',
                        'Errores recurrentes en logs de base de datos'
                    ]),
                    category: getRandomItem(['Hardware', 'Software', 'Red', 'Seguridad', 'Aplicaci√≥n']),
                    severity: getRandomItem(['Cr√≠tica', 'Alta', 'Media', 'Baja']),
                    relatedIncidents: Math.floor(Math.random() * 10) + 1,
                    status: getRandomItem(['Nuevo', 'En An√°lisis', 'Soluci√≥n Identificada', 'Resuelto']),
                    assigned: getRandomItem(['Juan P√©rez', 'Ana Garc√≠a', 'Carlos L√≥pez'])
                });
            }

            dataStore.capacity = [
                { name: 'CPU Servidor Web', current: 67, capacity: 100, unit: '%', trend: 'up' },
                { name: 'Memoria RAM', current: 82, capacity: 100, unit: '%', trend: 'up' },
                { name: 'Almacenamiento SAN', current: 73, capacity: 100, unit: '%', trend: 'up' },
                { name: 'Ancho de Banda', current: 45, capacity: 100, unit: '%', trend: 'neutral' },
                { name: 'Licencias Disponibles', current: 340, capacity: 500, unit: '', trend: 'neutral' },
                { name: 'Conexiones BD', current: 156, capacity: 200, unit: '', trend: 'up' }
            ];

            const activityTypes = [
                { icon: 'üö®', text: 'Nuevo incidente registrado: INC-1023', time: '2 minutos' },
                { icon: '‚úÖ', text: 'Incidente INC-1015 resuelto por Ana Garc√≠a', time: '15 minutos' },
                { icon: 'üîÑ', text: 'Cambio CHG-2008 aprobado por el comit√©', time: '1 hora' },
                { icon: 'üìä', text: 'SLA alcanzado: 99.8% de disponibilidad', time: '2 horas' },
                { icon: 'üîß', text: 'Problema PRB-3004 en an√°lisis', time: '3 horas' },
                { icon: '‚ö†Ô∏è', text: 'Alerta: Alto uso de CPU en servidor DB01', time: '4 horas' },
                { icon: 'üíæ', text: 'Backup completado exitosamente', time: '5 horas' },
                { icon: 'üë§', text: 'Nuevo usuario agregado al sistema', time: '6 horas' }
            ];

            dataStore.activities = activityTypes;

            for (let i = 1; i <= 5; i++) {
                const reportDate = new Date();
                reportDate.setDate(reportDate.getDate() - i * 7);
                dataStore.reports.push({
                    date: reportDate.toLocaleDateString('es-ES'),
                    type: getRandomItem(['Mensual', 'SLA', 'Incidentes', 'Disponibilidad']),
                    period: `Semana ${52 - i}`,
                    generatedBy: getRandomItem(['Sistema Autom√°tico', 'Juan P√©rez', 'Ana Garc√≠a']),
                    fileName: `Reporte_${reportDate.toISOString().split('T')[0]}.pdf`
                });
            }
        }

        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function renderAllComponents() {
            renderKPIs();
            renderIncidentsTable();
            updateIncidentStats();
            renderServiceMap();
            renderSLAMonitoring();
            renderChangesTable();
            renderProblemsTable();
            renderCapacityMetrics();
            renderActivityTimeline();
            renderReportsHistory();
            renderCharts();
            updateAlertBanner();
        }

        function renderKPIs() {
            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = dataStore.kpis.map(kpi => {
                const performance = kpi.unit === '%' ? 
                    (kpi.value >= kpi.target ? 'optimal' : 'warning') :
                    (kpi.value <= kpi.target ? 'optimal' : 'warning');
                
                return `
                <div class="kpi-card" onclick="showKPIDetail(${kpi.id})">
                    <div class="kpi-header">
                        <span class="kpi-icon">${kpi.icon}</span>
                        <span class="kpi-trend">${kpi.trend === 'up' ? 'üìà' : kpi.trend === 'down' ? 'üìâ' : '‚û°Ô∏è'}</span>
                    </div>
                    <div class="kpi-title">${kpi.title}</div>
                    <div class="kpi-value">${kpi.value}${kpi.unit}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Objetivo: ${kpi.target}${kpi.unit}
                    </div>
                    <canvas class="kpi-sparkline" id="spark-${kpi.id}"></canvas>
                    <div class="kpi-footer">
                        <span style="color: ${performance === 'optimal' ? 'var(--success)' : 'var(--warning)'};">
                            ${performance === 'optimal' ? '‚úì En objetivo' : '‚ö† Atenci√≥n'}
                        </span>
                        <button class="btn-small" onclick="event.stopPropagation(); showKPIDetail(${kpi.id})">Detalle</button>
                    </div>
                </div>
            `}).join('');

            dataStore.kpis.forEach(kpi => drawSparkline(kpi.id));
        }

        function drawSparkline(kpiId) {
            const canvas = document.getElementById(`spark-${kpiId}`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = Array.from({length: 20}, () => Math.random() * 40 + 30);
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;
            
            ctx.strokeStyle = '#2a6fdf';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - ((value - min) / range) * height;
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.stroke();
        }

        function renderIncidentsTable() {
            const tbody = document.getElementById('incidentsTableBody');
            tbody.innerHTML = dataStore.incidents.map(inc => `
                <tr onclick="showIncidentDetail('${inc.id}')">
                    <td><strong>${inc.id}</strong></td>
                    <td>${inc.title}</td>
                    <td class="priority-${inc.priority}">${inc.priority.toUpperCase()}</td>
                    <td><span class="status-badge status-${inc.status.toLowerCase().replace(' ', '-')}">${inc.status}</span></td>
                    <td>${inc.service}</td>
                    <td>${inc.assigned}</td>
                    <td>${inc.openDate}</td>
                    <td>
                        <button class="btn-small" onclick="event.stopPropagation(); editIncident('${inc.id}')">Editar</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateIncidentStats() {
            document.getElementById('totalIncidents').textContent = dataStore.incidents.length;
            document.getElementById('openIncidents').textContent = 
                dataStore.incidents.filter(i => i.status === 'Abierto').length;
            document.getElementById('criticalIncidents').textContent = 
                dataStore.incidents.filter(i => i.priority === 'critical').length;
            document.getElementById('avgResolutionTime').textContent = '2.3h';
        }

        function renderServiceMap() {
            const map = document.getElementById('serviceMap');
            map.innerHTML = dataStore.services.map(service => {
                const statusColor = service.status === 'online' ? '#4caf50' : '#ff9800';
                return `
                <div style="background: linear-gradient(135deg, ${statusColor} 0%, ${statusColor}dd 100%); color: white; padding: 1.5rem; border-radius: 12px; cursor: pointer; transition: all 0.3s;" 
                     onclick="showServiceDetail('${service.name}')"
                     onmouseover="this.style.transform='translateY(-5px) scale(1.02)'"
                     onmouseout="this.style.transform='translateY(0) scale(1)'">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <strong>${service.name}</strong>
                        <span style="font-size: 1.5rem;">${service.status === 'online' ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                    </div>
                    <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">
                        Disponibilidad: <strong>${service.availability}%</strong>
                    </div>
                    <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">
                        Usuarios: <strong>${service.users}</strong>
                    </div>
                    <div style="font-size: 0.9rem;">
                        Tiempo Respuesta: <strong>${service.responseTime}ms</strong>
                    </div>
                    <div class="progress-bar" style="margin-top: 1rem;">
                        <div class="progress-fill" style="width: ${service.availability}%;"></div>
                    </div>
                </div>
            `}).join('');
        }

        function renderSLAMonitoring() {
            const container = document.getElementById('slaMonitoring');
            const slaData = [
                { service: 'Correo Electr√≥nico', target: 99.5, current: 99.9, incidents: 2 },
                { service: 'ERP Corporativo', target: 99.0, current: 99.7, incidents: 5 },
                { service: 'CRM Ventas', target: 98.5, current: 99.8, incidents: 1 },
                { service: 'Portal Intranet', target: 98.0, current: 98.2, incidents: 8 }
            ];

            container.innerHTML = slaData.map(sla => {
                const compliance = ((sla.current / sla.target) * 100).toFixed(1);
                const status = sla.current >= sla.target ? 'success' : 'warning';
                return `
                    <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4>${sla.service}</h4>
                            <span style="color: var(--${status}); font-weight: bold;">
                                ${sla.current >= sla.target ? '‚úì' : '‚ö†'} ${compliance}%
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; font-size: 0.9rem;">
                            <div>
                                <div style="color: var(--text-secondary);">Objetivo</div>
                                <div style="font-weight: bold;">${sla.target}%</div>
                            </div>
                            <div>
                                <div style="color: var(--text-secondary);">Actual</div>
                                <div style="font-weight: bold;">${sla.current}%</div>
                            </div>
                            <div>
                                <div style="color: var(--text-secondary);">Incidentes</div>
                                <div style="font-weight: bold;">${sla.incidents}</div>
                            </div>
                        </div>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" style="width: ${(sla.current / sla.target) * 100}%; background: var(--${status});"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderChangesTable() {
            const tbody = document.getElementById('changesTableBody');
            tbody.innerHTML = dataStore.changes.map(change => `
                <tr onclick="showChangeDetail('${change.id}')">
                    <td><strong>${change.id}</strong></td>
                    <td>${change.description}</td>
                    <td><span class="status-badge status-online">${change.type}</span></td>
                    <td class="${change.impact === 'Alto' ? 'priority-high' : change.impact === 'Medio' ? 'priority-medium' : 'priority-low'}">${change.impact}</td>
                    <td>${change.status}</td>
                    <td>${change.plannedDate}</td>
                    <td>${change.requester}</td>
                </tr>
            `).join('');
        }

        function renderProblemsTable() {
            const tbody = document.getElementById('problemsTableBody');
            tbody.innerHTML = dataStore.problems.map(problem => `
                <tr onclick="showProblemDetail('${problem.id}')">
                    <td><strong>${problem.id}</strong></td>
                    <td>${problem.description}</td>
                    <td>${problem.category}</td>
                    <td class="${problem.severity === 'Cr√≠tica' ? 'priority-critical' : problem.severity === 'Alta' ? 'priority-high' : 'priority-medium'}">${problem.severity}</td>
                    <td><span class="status-badge status-warning">${problem.relatedIncidents}</span></td>
                    <td>${problem.status}</td>
                    <td>${problem.assigned}</td>
                </tr>
            `).join('');
        }

        function renderCapacityMetrics() {
            const container = document.getElementById('capacityMetrics');
            container.innerHTML = dataStore.capacity.map(metric => {
                const percentage = metric.unit === '%' ? metric.current : (metric.current / metric.capacity * 100);
                const status = percentage > 80 ? 'danger' : percentage > 60 ? 'warning' : 'success';
                return `
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <span class="kpi-icon">${metric.trend === 'up' ? 'üìà' : '‚û°Ô∏è'}</span>
                        </div>
                        <div class="kpi-title">${metric.name}</div>
                        <div class="kpi-value">${metric.current}${metric.unit}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            Capacidad: ${metric.capacity}${metric.unit}
                        </div>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" style="width: ${percentage}%; background: var(--${status});"></div>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--${status}); font-weight: bold;">
                            ${percentage.toFixed(1)}% de uso
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCapacityChart() {
            const canvas = document.getElementById('capacityChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 300;
            const padding = 50;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = Array.from({length: 24}, () => Math.random() * 40 + 40);
            const max = 100;
            const stepX = (width - padding * 2) / (data.length - 1);
            
            const bgColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-card').trim();
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-main').trim();
            
            // Dibujar √°rea de fondo
            ctx.fillStyle = 'rgba(42, 111, 223, 0.1)';
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            data.forEach((value, index) => {
                const x = padding + index * stepX;
                const y = height - padding - (value / max) * (height - padding * 2);
                ctx.lineTo(x, y);
            });
            ctx.lineTo(padding + (data.length - 1) * stepX, height - padding);
            ctx.closePath();
            ctx.fill();
            
            // Dibujar l√≠nea principal
            ctx.strokeStyle = '#2a6fdf';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = padding + index * stepX;
                const y = height - padding - (value / max) * (height - padding * 2);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
                
                // Puntos
                ctx.fillStyle = '#2a6fdf';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.strokeStyle = '#2a6fdf';
            ctx.stroke();
            
            // Etiquetas del eje X
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            for (let i = 0; i < 24; i += 3) {
                const x = padding + i * stepX;
                ctx.fillText(`${i}:00`, x, height - 15);
            }
            
            // Etiquetas del eje Y
            ctx.textAlign = 'right';
            for (let i = 0; i <= 100; i += 25) {
                const y = height - padding - (i / max) * (height - padding * 2);
                ctx.fillText(`${i}%`, padding - 10, y + 5);
            }
        }

        function renderActivityTimeline() {
            const timeline = document.getElementById('activityTimeline');
            timeline.innerHTML = dataStore.activities.map(activity => `
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.2rem;">${activity.icon}</span>
                            <strong>${activity.text}</strong>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            Hace ${activity.time}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderReportsHistory() {
            const tbody = document.getElementById('reportsHistoryBody');
            tbody.innerHTML = dataStore.reports.map(report => `
                <tr>
                    <td>${report.date}</td>
                    <td><span class="status-badge status-online">${report.type}</span></td>
                    <td>${report.period}</td>
                    <td>${report.generatedBy}</td>
                    <td>
                        <button class="btn-small" onclick="downloadReport('${report.fileName}')">üì• Descargar</button>
                        <button class="btn-small" onclick="viewReport('${report.fileName}')">üëÅÔ∏è Ver</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderCharts() {
            drawDonutChart();
            drawLineChart();
        }

        function drawDonutChart() {
            const canvas = document.getElementById('donutChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            ctx.clearRect(0, 0, width, height);
            
            const criticalCount = dataStore.incidents.filter(i => i.priority === 'critical').length;
            const highCount = dataStore.incidents.filter(i => i.priority === 'high').length;
            const mediumCount = dataStore.incidents.filter(i => i.priority === 'medium').length;
            const lowCount = dataStore.incidents.filter(i => i.priority === 'low').length;
            
            const data = [criticalCount, highCount, mediumCount, lowCount];
            const colors = ['#f44336', '#ff9800', '#2196f3', '#4caf50'];
            const labels = ['Cr√≠tico', 'Alto', 'Medio', 'Bajo'];
            const total = data.reduce((a, b) => a + b, 0);
            
            let currentAngle = -Math.PI / 2;
            
            data.forEach((value, index) => {
                const sliceAngle = (value / total) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[index];
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Etiquetas
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * radius * 1.3;
                const labelY = centerY + Math.sin(labelAngle) * radius * 1.3;
                
                ctx.fillStyle = colors[index];
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${labels[index]}: ${value}`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
            
            // Centro del donut
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.6, 0, 2 * Math.PI);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg-card');
            ctx.fill();
            
            // Texto central
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-main');
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(total, centerX, centerY - 10);
            ctx.font = '14px Arial';
            ctx.fillText('Total', centerX, centerY + 15);
        }

        function drawLineChart() {
            const canvas = document.getElementById('lineChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = Array.from({length: 12}, () => Math.random() * 30 + 10);
            const max = Math.max(...data);
            const stepX = (width - padding * 2) / (data.length - 1);
            
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-main').trim();
            
            // √Årea de fondo
            ctx.fillStyle = 'rgba(42, 111, 223, 0.1)';
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            data.forEach((value, index) => {
                const x = padding + index * stepX;
                const y = height - padding - (value / max) * (height - padding * 2);
                ctx.lineTo(x, y);
            });
            ctx.lineTo(padding + (data.length - 1) * stepX, height - padding);
            ctx.closePath();
            ctx.fill();
            
            // L√≠nea principal
            ctx.strokeStyle = '#2a6fdf';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = padding + index * stepX;
                const y = height - padding - (value / max) * (height - padding * 2);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
                
                // Puntos
                ctx.fillStyle = '#2a6fdf';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.strokeStyle = '#2a6fdf';
            ctx.stroke();
            
            // Etiquetas
            ctx.fillStyle = textColor;
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            for (let i = 0; i < 12; i++) {
                ctx.fillText(`M${i + 1}`, padding + i * stepX, height - 10);
            }
        }

        function startAutoUpdate() {
            updateInterval = setInterval(() => {
                updateDynamicData();
                renderAllComponents();
                lastUpdateTime = Date.now();
            }, 8000);
        }

        function updateDynamicData() {
            dataStore.kpis = dataStore.kpis.map(kpi => {
                let newValue = kpi.value;
                const variation = (Math.random() - 0.5) * 2;
                
                if (kpi.unit === '%') {
                    newValue = Math.max(0, Math.min(100, kpi.value + variation * 0.1));
                } else if (kpi.unit === 'h') {
                    newValue = Math.max(0.5, kpi.value + variation * 0.1);
                } else if (kpi.unit === '/5') {
                    newValue = Math.max(1, Math.min(5, kpi.value + variation * 0.05));
                } else {
                    newValue = Math.max(0, kpi.value + Math.floor(variation));
                }
                
                const oldValue = kpi.value;
                const trend = newValue > oldValue ? 'up' : newValue < oldValue ? 'down' : 'neutral';
                
                return { ...kpi, value: Math.round(newValue * 100) / 100, trend };
            });
            
            dataStore.capacity = dataStore.capacity.map(metric => {
                const variation = (Math.random() - 0.5) * 5;
                let newValue;
                if (metric.unit === '%') {
                    newValue = Math.max(0, Math.min(100, metric.current + variation));
                } else {
                    newValue = Math.max(0, Math.min(metric.capacity, metric.current + Math.floor(variation)));
                }
                return { ...metric, current: Math.round(newValue) };
            });
            
            if (Math.random() > 0.8) {
                updateAlertBanner();
            }
        }

        function updateAlertBanner() {
            const alerts = [
                { title: 'Sistema Operativo', message: 'Todos los servicios funcionando correctamente' },
                { title: 'Mantenimiento Programado', message: 'Actualizaci√≥n de firewall ma√±ana 02:00 AM' },
                { title: 'Alto Uso de CPU', message: 'Servidor DB01 al 85% de capacidad' },
                { title: 'Backup Exitoso', message: 'Respaldo completado satisfactoriamente' },
                { title: 'Actualizaci√≥n Disponible', message: 'Nueva versi√≥n del sistema de gesti√≥n disponible' },
                { title: 'SLA en Riesgo', message: 'Portal Intranet cerca del l√≠mite de disponibilidad' },
                { title: 'Incidente Cr√≠tico Resuelto', message: 'Servicio de email restaurado completamente' }
            ];
            
            const alert = getRandomItem(alerts);
            document.getElementById('alertTitle').textContent = alert.title + ':';
            document.getElementById('alertMessage').textContent = alert.message;
        }

        // Funciones de interacci√≥n

        function showKPIDetail(id) {
            const kpi = dataStore.kpis.find(k => k.id === id);
            if (!kpi) return;
            
            const trendText = kpi.trend === 'up' ? 'üìà Ascendente' : kpi.trend === 'down' ? 'üìâ Descendente' : '‚û°Ô∏è Estable';
            const performance = (kpi.unit === '%' ? 
                (kpi.value >= kpi.target ? '√ìptimo' : 'Requiere Atenci√≥n') :
                (kpi.value <= kpi.target ? '√ìptimo' : 'Requiere Atenci√≥n'));
            
            openModal(`Detalle de KPI: ${kpi.title}`, `
                <h3>${kpi.icon} ${kpi.title}</h3>
                <div style="font-size: 3rem; font-weight: bold; color: var(--primary-light); text-align: center; margin: 2rem 0;">
                    ${kpi.value}${kpi.unit}
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem;">
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Tendencia</div>
                        <div style="font-size: 1.5rem;">${trendText}</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Estado</div>
                        <div style="font-size: 1.5rem; color: var(--success);">‚óè Activo</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Objetivo</div>
                        <div style="font-size: 1.5rem;">${kpi.target}${kpi.unit}</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Rendimiento</div>
                        <div style="font-size: 1.5rem;">${performance}</div>
                    </div>
                </div>
                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem;">Historial (√öltimos 7 d√≠as)</h4>
                    <canvas id="kpiDetailChart" width="600" height="200"></canvas>
                </div>
                <p style="margin-top: 2rem; color: var(--text-secondary);">
                    Este KPI se actualiza autom√°ticamente cada 8 segundos con datos en tiempo real del sistema de gesti√≥n de servicios TI.
                    Los valores hist√≥ricos muestran la tendencia y permiten an√°lisis de rendimiento.
                </p>
            `);
            
            setTimeout(() => {
                const canvas = document.getElementById('kpiDetailChart');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const width = canvas.width;
                    const height = canvas.height;
                    const padding = 30;
                    
                    const data = Array.from({length: 7}, () => kpi.value + (Math.random() - 0.5) * 5);
                    const max = Math.max(...data, kpi.target);
                    const min = Math.min(...data, kpi.target);
                    const range = max - min || 1;
                    const stepX = (width - padding * 2) / (data.length - 1);
                    
                    // L√≠nea de objetivo
                    const targetY = height - padding - ((kpi.target - min) / range) * (height - padding * 2);
                    ctx.strokeStyle = '#ff9800';
                    ctx.setLineDash([5, 5]);
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(padding, targetY);
                    ctx.lineTo(width - padding, targetY);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // L√≠nea de datos
                    ctx.strokeStyle = '#2a6fdf';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    data.forEach((value, index) => {
                        const x = padding + index * stepX;
                        const y = height - padding - ((value - min) / range) * (height - padding * 2);
                        if (index === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                        
                        ctx.fillStyle = '#2a6fdf';
                        ctx.beginPath();
                        ctx.arc(x, y, 5, 0, 2 * Math.PI);
                        ctx.fill();
                    });
                    
                    ctx.stroke();
                }
            }, 100);
        }

        function showIncidentDetail(id) {
            const incident = dataStore.incidents.find(i => i.id === id);
            if (!incident) return;
            
            openModal(`Detalle del Incidente: ${id}`, `
                <div style="margin-bottom: 2rem;">
                    <h3>${incident.title}</h3>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                        <span class="status-badge status-${incident.status.toLowerCase().replace(' ', '-')}">${incident.status}</span>
                        <span class="priority-${incident.priority}" style="font-weight: bold;">${incident.priority.toUpperCase()}</span>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Servicio Afectado</div>
                        <div style="font-weight: bold; margin-top: 0.5rem;">${incident.service}</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Asignado a</div>
                        <div style="font-weight: bold; margin-top: 0.5rem;">${incident.assigned}</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Fecha de Apertura</div>
                        <div style="font-weight: bold; margin-top: 0.5rem;">${incident.openDate}</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Tiempo Transcurrido</div>
                        <div style="font-weight: bold; margin-top: 0.5rem;">${Math.floor(Math.random() * 48) + 1}h</div>
                    </div>
                </div>
                
                <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="margin-bottom: 1rem;">Descripci√≥n Detallada</h4>
                    <p>Este incidente ha sido reportado por usuarios que experimentan problemas con el servicio ${incident.service}. 
                    El equipo t√©cnico est√° trabajando activamente en la resoluci√≥n.</p>
                </div>
                
                <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="margin-bottom: 1rem;">Acciones Tomadas</h4>
                    <ul style="margin-left: 1.5rem;">
                        <li>Verificaci√≥n inicial del sistema</li>
                        <li>An√°lisis de logs del servidor</li>
                        <li>Asignaci√≥n al equipo t√©cnico especializado</li>
                    </ul>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn btn-success" onclick="closeModal(); alert('‚úÖ Incidente actualizado')">Actualizar Estado</button>
                    <button class="btn btn-info" onclick="closeModal(); alert('üìß Comentario a√±adido')">A√±adir Comentario</button>
                    <button class="btn btn-warning" onclick="closeModal(); alert('üë§ T√©cnico reasignado')">Reasignar</button>
                </div>
            `);
        }

        function showServiceDetail(serviceName) {
            const service = dataStore.services.find(s => s.name === serviceName);
            if (!service) return;
            
            openModal(`Detalle del Servicio: ${serviceName}`, `
                <h3>${serviceName}</h3>
                <div style="margin: 2rem 0;">
                    <span class="status-badge status-${service.status}">${service.status === 'online' ? 'En L√≠nea' : 'Advertencia'}</span>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Disponibilidad</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--success);">${service.availability}%</div>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" style="width: ${service.availability}%;"></div>
                        </div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Usuarios Activos</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary-light);">${service.users}</div>
                        <div style="margin-top: 1rem; font-size: 0.85rem;">Conexiones simult√°neas</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Tiempo de Respuesta</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--info);">${service.responseTime}ms</div>
                        <div style="margin-top: 1rem; font-size: 0.85rem;">Promedio √∫ltimas 24h</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Incidentes del Mes</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--warning);">${Math.floor(Math.random() * 10)}</div>
                        <div style="margin-top: 1rem; font-size: 0.85rem;">Total reportados</div>
                    </div>
                </div>
                
                <div style="background: var(--bg-main); padding: 1.5rem; border-radius: 8px;">
                    <h4 style="margin-bottom: 1rem;">Informaci√≥n del Servicio</h4>
                    <p style="color: var(--text-secondary); line-height: 1.8;">
                        Este servicio es cr√≠tico para las operaciones diarias de la organizaci√≥n. 
                        Se monitorea continuamente y cuenta con redundancia para garantizar alta disponibilidad.
                        El equipo de soporte est√° disponible 24/7 para atender cualquier incidencia.
                    </p>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn btn-info" onclick="closeModal(); alert('üîÑ Estado actualizado')">Actualizar Estado</button>
                    <button class="btn btn-warning" onclick="closeModal(); alert('üîß Mantenimiento programado')">Programar Mantenimiento</button>
                </div>
            `);
        }

        function showChangeDetail(id) {
            alert(`üìã Mostrando detalles del cambio ${id}`);
        }

        function showProblemDetail(id) {
            alert(`üîç Mostrando detalles del problema ${id}`);
        }

        function dismissAlert() {
            alert('‚úÖ Alerta marcada como le√≠da');
            updateAlertBanner();
        }

        function exportData(type = 'general') {
            const date = new Date().toISOString().split('T')[0];
            alert(`‚úÖ Exportaci√≥n completada.\nArchivo: ${type}_${date}.xlsx\n\nEl archivo se ha descargado correctamente.`);
        }

        function refreshIncidents() {
            alert('üîÑ Actualizando lista de incidentes...');
            setTimeout(() => {
                renderIncidentsTable();
                updateIncidentStats();
                alert('‚úÖ Lista de incidentes actualizada');
            }, 500);
        }

        function refreshServices() {
            alert('üîÑ Actualizando estado de servicios...');
            setTimeout(() => {
                renderServiceMap();
                alert('‚úÖ Estado de servicios actualizado');
            }, 500);
        }

        function openNewIncidentModal() {
            openModal('Registrar Nuevo Incidente', `
                <form style="display: grid; gap: 1rem;" onsubmit="event.preventDefault(); submitNewIncident();">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">T√≠tulo del Incidente</label>
                        <input type="text" id="incidentTitle" class="filter-input" placeholder="Descripci√≥n breve del incidente" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Prioridad</label>
                            <select id="incidentPriority" class="filter-input" required>
                                <option value="low">Baja</option>
                                <option value="medium" selected>Media</option>
                                <option value="high">Alta</option>
                                <option value="critical">Cr√≠tica</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Servicio Afectado</label>
                            <select id="incidentService" class="filter-input" required>
                                <option>Email</option>
                                <option>ERP</option>
                                <option>CRM</option>
                                <option>Portal</option>
                                <option>Base de Datos</option>
                                <option>Red</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Descripci√≥n Detallada</label>
                        <textarea id="incidentDescription" class="filter-input" rows="4" placeholder="Describe el problema en detalle..." required></textarea>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Asignar a</label>
                        <select id="incidentAssigned" class="filter-input" required>
                            <option>Juan P√©rez</option>
                            <option>Ana Garc√≠a</option>
                            <option>Carlos L√≥pez</option>
                            <option>Mar√≠a Rodr√≠guez</option>
                            <option>Luis Mart√≠nez</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="submit" class="btn btn-success">‚úÖ Registrar Incidente</button>
                        <button type="button" class="btn btn-danger" onclick="closeModal()">‚ùå Cancelar</button>
                    </div>
                </form>
            `);
        }

        function submitNewIncident() {
            const newIncident = {
                id: `INC-${1016 + dataStore.incidents.length}`,
                title: document.getElementById('incidentTitle').value,
                priority: document.getElementById('incidentPriority').value,
                status: 'Abierto',
                service: document.getElementById('incidentService').value,
                assigned: document.getElementById('incidentAssigned').value,
                openDate: new Date().toLocaleDateString('es-ES')
            };
            
            dataStore.incidents.unshift(newIncident);
            renderIncidentsTable();
            updateIncidentStats();
            closeModal();
            alert(`‚úÖ Incidente ${newIncident.id} registrado exitosamente`);
        }

        function editIncident(id) {
            alert(`‚úèÔ∏è Editando incidente ${id}`);
        }

        function openNewChangeModal() {
            openModal('Solicitar Nuevo Cambio', `
                <form style="display: grid; gap: 1rem;" onsubmit="event.preventDefault(); submitNewChange();">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Descripci√≥n del Cambio</label>
                        <input type="text" id="changeDescription" class="filter-input" placeholder="Descripci√≥n del cambio solicitado" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Tipo</label>
                            <select id="changeType" class="filter-input" required>
                                <option>Est√°ndar</option>
                                <option>Normal</option>
                                <option>Emergencia</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Impacto</label>
                            <select id="changeImpact" class="filter-input" required>
                                <option>Bajo</option>
                                <option>Medio</option>
                                <option>Alto</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Fecha Planificada</label>
                        <input type="date" id="changePlannedDate" class="filter-input" required>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Justificaci√≥n</label>
                        <textarea id="changeJustification" class="filter-input" rows="3" placeholder="Justificaci√≥n del cambio..." required></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="submit" class="btn btn-success">‚úÖ Solicitar Cambio</button>
                        <button type="button" class="btn btn-danger" onclick="closeModal()">‚ùå Cancelar</button>
                    </div>
                </form>
            `);
        }

        function submitNewChange() {
            closeModal();
            alert('‚úÖ Solicitud de cambio registrada exitosamente. En espera de aprobaci√≥n del comit√©.');
        }

        function openNewProblemModal() {
            openModal('Registrar Nuevo Problema', `
                <form style="display: grid; gap: 1rem;" onsubmit="event.preventDefault(); submitNewProblem();">
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Descripci√≥n del Problema</label>
                        <input type="text" id="problemDescription" class="filter-input" placeholder="Descripci√≥n breve del problema" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Categor√≠a</label>
                            <select id="problemCategory" class="filter-input" required>
                                <option>Hardware</option>
                                <option>Software</option>
                                <option>Red</option>
                                <option>Seguridad</option>
                                <option>Aplicaci√≥n</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Severidad</label>
                            <select id="problemSeverity" class="filter-input" required>
                                <option>Baja</option>
                                <option>Media</option>
                                <option>Alta</option>
                                <option>Cr√≠tica</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">An√°lisis Inicial</label>
                        <textarea id="problemAnalysis" class="filter-input" rows="4" placeholder="An√°lisis inicial del problema..." required></textarea>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Asignar a</label>
                        <select id="problemAssigned" class="filter-input" required>
                            <option>Juan P√©rez</option>
                            <option>Ana Garc√≠a</option>
                            <option>Carlos L√≥pez</option>
                            <option>Mar√≠a Rodr√≠guez</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button type="submit" class="btn btn-warning">‚úÖ Registrar Problema</button>
                        <button type="button" class="btn btn-danger" onclick="closeModal()">‚ùå Cancelar</button>
                    </div>
                </form>
            `);
        }

        function submitNewProblem() {
            closeModal();
            alert('‚úÖ Problema registrado exitosamente. Se ha iniciado el an√°lisis de causa ra√≠z.');
        }

        function generateReport(type) {
            const reportTypes = {
                'monthly': 'Reporte Mensual de Gesti√≥n',
                'sla': 'An√°lisis de Cumplimiento SLA',
                'incidents': 'Reporte de An√°lisis de Incidentes',
                'availability': 'Reporte de Disponibilidad de Servicios',
                'changes': 'Reporte de Gesti√≥n de Cambios',
                'custom': 'Configuraci√≥n de Reporte Personalizado'
            };

            if (type === 'custom') {
                openModal('Configurar Reporte Personalizado', `
                    <form style="display: grid; gap: 1rem;" onsubmit="event.preventDefault(); generateCustomReport();">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nombre del Reporte</label>
                            <input type="text" class="filter-input" placeholder="Nombre descriptivo del reporte" required>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Periodo</label>
                            <select class="filter-input">
                                <option>√öltima semana</option>
                                <option>√öltimo mes</option>
                                <option>√öltimos 3 meses</option>
                                <option>√öltimo a√±o</option>
                                <option>Personalizado</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Incluir Secciones:</label>
                            <div style="display: grid; gap: 0.5rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> KPIs Principales
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> An√°lisis de Incidentes
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Gesti√≥n de Cambios
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Problemas Identificados
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> SLA y Disponibilidad
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> An√°lisis de Capacidad
                                </label>
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button type="submit" class="btn btn-success">üìä Generar Reporte</button>
                            <button type="button" class="btn" onclick="closeModal()">Cancelar</button>
                        </div>
                    </form>
                `);
            } else {
                openModal(`Generando ${reportTypes[type]}`, `
                    <div style="text-align: center; padding: 2rem;">
                        <div class="loader" style="margin: 0 auto 2rem;"></div>
                        <p style="font-size: 1.1rem; color: var(--text-secondary);">
                            Recopilando datos y generando reporte...
                        </p>
                    </div>
                `);

                setTimeout(() => {
                    closeModal();
                    alert(`‚úÖ Reporte generado exitosamente\n\nTipo: ${reportTypes[type]}\nArchivo: ${type}_${new Date().toISOString().split('T')[0]}.pdf\n\nEl reporte est√° listo para descargar.`);
                }, 2000);
            }
        }

        function generateCustomReport() {
            closeModal();
            alert('‚úÖ Reporte personalizado generado exitosamente');
        }

        function downloadReport(fileName) {
            alert(`üì• Descargando reporte: ${fileName}`);
        }

        function viewReport(fileName) {
            alert(`üëÅÔ∏è Abriendo vista previa del reporte: ${fileName}`);
        }

        function filterTable(tableId, searchValue) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const searchLower = searchValue.toLowerCase();

            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchLower) ? '' : 'none';
            }
        }

        function filterByPriority(priority) {
            const rows = document.getElementById('incidentsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let row of rows) {
                if (priority === '') {
                    row.style.display = '';
                } else {
                    const priorityCell = row.getElementsByTagName('td')[2];
                    row.style.display = priorityCell.textContent.toLowerCase().includes(priority) ? '' : 'none';
                }
            }
        }

        function filterByStatus(status) {
            const rows = document.getElementById('incidentsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let row of rows) {
                if (status === '') {
                    row.style.display = '';
                } else {
                    const statusCell = row.getElementsByTagName('td')[3];
                    row.style.display = statusCell.textContent.includes(status) ? '' : 'none';
                }
            }
        }

        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('genericModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('genericModal').classList.remove('active');
        }

        // Event Listeners
        document.getElementById('genericModal').addEventListener('click', (e) => {
            if (e.target.id === 'genericModal') {
                closeModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                renderCharts();
                if (document.getElementById('capacity').classList.contains('active')) {
                    renderCapacityChart();
                }
            }, 250);
        });

        // Atajos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        document.querySelector('.tab:nth-child(1)').click();
                        break;
                    case '2':
                        e.preventDefault();
                        document.querySelector('.tab:nth-child(2)').click();
                        break;
                    case '3':
                        e.preventDefault();
                        document.querySelector('.tab:nth-child(3)').click();
                        break;
                    case 'n':
                        e.preventDefault();
                        if (document.getElementById('incidents').classList.contains('active')) {
                            openNewIncidentModal();
                        }
                        break;
                }
            }
        });

        // Notificaciones del sistema
        function showNotification(title, message, type = 'info') {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'üìä'
                });
            }
        }

        // Solicitar permiso para notificaciones
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Detectar inactividad
        let inactivityTime = 0;
        setInterval(() => {
            inactivityTime++;
            if (inactivityTime > 300) { // 5 minutos
                console.log('Usuario inactivo - considerando pausar actualizaciones autom√°ticas');
            }
        }, 1000);

        document.addEventListener('mousemove', () => { inactivityTime = 0; });
        document.addEventListener('keypress', () => { inactivityTime = 0; });

        // Logs del sistema
        console.log('%cüéØ PEIGSTI - TechSolutions S.A.', 'font-size: 20px; font-weight: bold; color: #2a6fdf;');
        console.log('%cPlataforma Ejecutiva Integral de Gesti√≥n de Servicios TI', 'font-size: 14px; color: #666;');
        console.log('%cISO/IEC 20000-1:2018 Certified System', 'font-size: 12px; color: #4caf50;');
        console.log('%c\nüìä Dashboard Caracter√≠sticas:', 'font-size: 12px; font-weight: bold; color: #2a6fdf;');
        console.log('- 12 KPIs en tiempo real');
        console.log('- Gesti√≥n completa de incidentes, problemas y cambios');
        console.log('- Monitoreo de 8 servicios cr√≠ticos');
        console.log('- An√°lisis de capacidad y recursos');
        console.log('- Centro de reportes ejecutivos');
        console.log('- Actualizaci√≥n autom√°tica cada 8 segundos');
        console.log('- Modo claro/oscuro');
        console.log('- Responsive design');
        console.log('\n‚å®Ô∏è Atajos de teclado:');
        console.log('- Ctrl/Cmd + 1/2/3: Cambiar entre tabs');
        console.log('- Ctrl/Cmd + N: Nuevo incidente (en tab de incidentes)');
        console.log('- ESC: Cerrar modal');
        console.log('\n‚úÖ Sistema inicializado correctamente');
    </script>
</body>
</html>
