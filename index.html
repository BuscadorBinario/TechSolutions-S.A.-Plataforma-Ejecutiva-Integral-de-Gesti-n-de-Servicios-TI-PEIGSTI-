<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PEIGSTI - TechSolutions S.A. | Dashboard Ejecutivo ISO 20000</title>
    <style>
        :root {
            --primary-dark: #0a2647;
            --primary-mid: #144272;
            --primary-light: #2a6fdf;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --bg-main: #f5f7fa;
            --bg-card: #ffffff;
            --text-main: #2c3e50;
            --text-secondary: #7f8c8d;
            --border: #e1e8ed;
            --shadow: rgba(0,0,0,0.08);
            --shadow-hover: rgba(0,0,0,0.15);
        }

        [data-theme="dark"] {
            --bg-main: #1a1a2e;
            --bg-card: #16213e;
            --text-main: #eee;
            --text-secondary: #bbb;
            --border: #2a3f5f;
            --shadow: rgba(0,0,0,0.3);
            --shadow-hover: rgba(0,0,0,0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        #loadingScreen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-mid) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loadingScreen h2 {
            margin-top: 20px;
            font-size: 1.5rem;
        }

        header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-mid) 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .logo-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--warning);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .title-block h1 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .title-block p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .header-info {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .info-label {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .container {
            max-width: 1800px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .tabs-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--border);
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(42, 111, 223, 0.1);
            color: var(--primary-light);
        }

        .tab.active {
            background: var(--primary-light);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-light);
            transition: width 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px var(--shadow-hover);
        }

        .kpi-card:hover::before {
            width: 100%;
            opacity: 0.05;
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .kpi-icon {
            font-size: 2rem;
            opacity: 0.8;
        }

        .kpi-trend {
            font-size: 1.2rem;
        }

        .kpi-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        [data-theme="dark"] .kpi-value {
            color: var(--primary-light);
        }

        .kpi-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .kpi-sparkline {
            width: 100%;
            height: 40px;
            margin-top: 0.5rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-small:hover {
            background: var(--primary-mid);
            transform: scale(1.05);
        }

        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        [data-theme="dark"] .section-title {
            color: var(--primary-light);
        }

        .section-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            background: var(--primary-light);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-mid);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-success { background: var(--success); }
        .btn-warning { background: var(--warning); }
        .btn-danger { background: var(--danger); }

        .alert-banner {
            background: linear-gradient(135deg, var(--warning) 0%, #f57c00 100%);
            color: white;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px var(--shadow);
            animation: slideDown 0.5s;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .chart-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .chart-canvas {
            width: 100%;
            max-height: 400px;
            border-radius: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--danger);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .modal-close:hover {
            transform: rotate(90deg);
            background: #d32f2f;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
        }

        thead {
            background: var(--primary-dark);
            color: white;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        tbody tr {
            transition: background 0.3s;
        }

        tbody tr:hover {
            background: rgba(42, 111, 223, 0.05);
        }

        .priority-critical { color: var(--danger); font-weight: 600; }
        .priority-high { color: var(--warning); font-weight: 600; }
        .priority-medium { color: var(--primary-light); font-weight: 600; }
        .priority-low { color: var(--success); font-weight: 600; }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .section {
                padding: 1rem;
            }

            .container {
                padding: 0 1rem;
            }
        }

        .text-center { text-align: center; }
        .mt-1 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <div class="loader"></div>
        <h2>Cargando Dashboard Ejecutivo ISO 20000...</h2>
        <p>TechSolutions S.A.</p>
    </div>

    <header>
        <div class="header-content">
            <div class="logo-title">
                <div class="logo">TS</div>
                <div class="title-block">
                    <h1>TechSolutions S.A. ‚Äì PEIGSTI</h1>
                    <p>ISO/IEC 20000-1:2018 | Dashboard Ejecutivo en Tiempo Real</p>
                </div>
            </div>
            <div class="header-info">
                <div class="info-item">
                    <span class="info-label">Fecha y Hora</span>
                    <span class="info-value" id="currentDateTime">--</span>
                </div>
                <div class="info-item">
                    <span class="info-label">√öltima Actualizaci√≥n</span>
                    <span class="info-value" id="lastUpdate">Hace 0s</span>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">üåì</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="alert-banner" id="alertBanner">
            <div class="alert-content">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <div>
                    <strong id="alertTitle">Alerta Activa:</strong>
                    <span id="alertMessage">Sistema funcionando correctamente</span>
                </div>
            </div>
            <div>
                <button class="btn-small" onclick="dismissAlert()">Marcar le√≠do</button>
            </div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">üìä Visi√≥n General</button>
                <button class="tab" onclick="switchTab('incidents')">üö® Incidentes</button>
                <button class="tab" onclick="switchTab('services')">üîß Servicios TI</button>
            </div>

            <div class="tab-content active" id="overview">
                <h2 style="margin: 2rem 0 1rem;">Panel de KPIs Ejecutivos</h2>
                <div class="kpi-grid" id="kpiGrid"></div>

                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üìä An√°lisis de Rendimiento</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                        <div>
                            <h4 class="text-center mb-1">Distribuci√≥n de Incidentes</h4>
                            <canvas id="donutChart" width="400" height="400"></canvas>
                        </div>
                        <div>
                            <h4 class="text-center mb-1">Tendencia Mensual</h4>
                            <canvas id="lineChart" width="400" height="400"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="incidents">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üö® Gesti√≥n de Incidentes</h3>
                        <button class="btn" onclick="exportData()">üì• Exportar</button>
                    </div>
                    <div class="table-container">
                        <table id="incidentsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>T√≠tulo</th>
                                    <th>Prioridad</th>
                                    <th>Estado</th>
                                    <th>Servicio</th>
                                    <th>Asignado</th>
                                </tr>
                            </thead>
                            <tbody id="incidentsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="services">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">üîß Mapa de Servicios TI</h3>
                    </div>
                    <div id="serviceMap" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="genericModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <h2 id="modalTitle">T√≠tulo del Modal</h2>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let updateInterval;
        let lastUpdateTime = Date.now();
        let dataStore = {
            kpis: [],
            incidents: [],
            services: []
        };

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                initializeDashboard();
            }, 1500);
        });

        function initializeDashboard() {
            updateDateTime();
            generateInitialData();
            renderAllComponents();
            startAutoUpdate();
            setInterval(updateDateTime, 1000);
            setInterval(updateLastUpdateIndicator, 1000);
        }

        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('currentDateTime').textContent = 
                now.toLocaleDateString('es-ES', options);
        }

        function updateLastUpdateIndicator() {
            const seconds = Math.floor((Date.now() - lastUpdateTime) / 1000);
            document.getElementById('lastUpdate').textContent = `Hace ${seconds}s`;
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            html.setAttribute('data-theme', currentTheme === 'dark' ? '' : 'dark');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function generateInitialData() {
            dataStore.kpis = [
                { id: 1, title: 'Disponibilidad General', value: 99.7, unit: '%', trend: 'up', icon: 'üìä' },
                { id: 2, title: 'Incidentes Abiertos', value: 23, unit: '', trend: 'down', icon: 'üö®' },
                { id: 3, title: 'Cambios Pendientes', value: 12, unit: '', trend: 'neutral', icon: 'üîÑ' },
                { id: 4, title: 'MTTR Promedio', value: 2.3, unit: 'h', trend: 'down', icon: '‚è±Ô∏è' },
                { id: 5, title: 'Satisfacci√≥n Usuario', value: 4.6, unit: '/5', trend: 'up', icon: 'üòä' },
                { id: 6, title: 'SLA Cumplimiento', value: 97.2, unit: '%', trend: 'up', icon: '‚úÖ' },
                { id: 7, title: 'Problemas Activos', value: 5, unit: '', trend: 'neutral', icon: 'üîß' },
                { id: 8, title: 'Riesgos Cr√≠ticos', value: 3, unit: '', trend: 'down', icon: '‚ö†Ô∏è' }
            ];

            for (let i = 1; i <= 15; i++) {
                dataStore.incidents.push({
                    id: `INC-${1000 + i}`,
                    title: `Incidente ${i}: ${getRandomItem(['Ca√≠da servicio', 'Error aplicaci√≥n', 'Problema red'])}`,
                    priority: getRandomItem(['critical', 'high', 'medium', 'low']),
                    status: getRandomItem(['Abierto', 'En Progreso', 'Resuelto']),
                    service: getRandomItem(['Email', 'ERP', 'CRM', 'Portal']),
                    assigned: getRandomItem(['Juan P√©rez', 'Ana Garc√≠a', 'Carlos L√≥pez'])
                });
            }

            dataStore.services = [
                { name: 'Correo Electr√≥nico', status: 'online', availability: 99.9, users: 450 },
                { name: 'ERP Corporativo', status: 'online', availability: 99.7, users: 320 },
                { name: 'CRM Ventas', status: 'online', availability: 99.8, users: 180 },
                { name: 'Portal Intranet', status: 'warning', availability: 98.2, users: 500 }
            ];
        }

        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function renderAllComponents() {
            renderKPIs();
            renderIncidentsTable();
            renderServiceMap();
            renderCharts();
            updateAlertBanner();
        }

        function renderKPIs() {
            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = dataStore.kpis.map(kpi => `
                <div class="kpi-card" onclick="showKPIDetail(${kpi.id})">
                    <div class="kpi-header">
                        <span class="kpi-icon">${kpi.icon}</span>
                        <span class="kpi-trend">${kpi.trend === 'up' ? 'üìà' : kpi.trend === 'down' ? 'üìâ' : '‚û°Ô∏è'}</span>
                    </div>
                    <div class="kpi-title">${kpi.title}</div>
                    <div class="kpi-value">${kpi.value}${kpi.unit}</div>
                    <canvas class="kpi-sparkline" id="spark-${kpi.id}"></canvas>
                    <div class="kpi-footer">
                        <button class="btn-small" onclick="event.stopPropagation(); showKPIDetail(${kpi.id})">Detalle</button>
                    </div>
                </div>
            `).join('');

            dataStore.kpis.forEach(kpi => drawSparkline(kpi.id));
        }

        function drawSparkline(kpiId) {
            const canvas = document.getElementById(`spark-${kpiId}`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = Array.from({length: 20}, () => Math.random() * 40 + 30);
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;
            
            ctx.strokeStyle = '#2a6fdf';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - ((value - min) / range) * height;
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.stroke();
        }

        function renderIncidentsTable() {
            const tbody = document.getElementById('incidentsTableBody');
            tbody.innerHTML = dataStore.incidents.slice(0, 10).map(inc => `
                <tr>
                    <td>${inc.id}</td>
                    <td>${inc.title}</td>
                    <td class="priority-${inc.priority}">${inc.priority.toUpperCase()}</td>
                    <td>${inc.status}</td>
                    <td>${inc.service}</td>
                    <td>${inc.assigned}</td>
                </tr>
            `).join('');
        }

        function renderServiceMap() {
            const map = document.getElementById('serviceMap');
            map.innerHTML = dataStore.services.map(service => `
                <div style="background: linear-gradient(135deg, #2a6fdf 0%, #144272 100%); color: white; padding: 1.5rem; border-radius: 12px; cursor: pointer; transition: all 0.3s;" 
                     onmouseover="this.style.transform='translateY(-5px) scale(1.02)'"
                     onmouseout="this.style.transform='translateY(0) scale(1)'">
                    <div style="margin-bottom: 1rem;">
                        <strong>${service.name}</strong>
                    </div>
                    <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">
                        Disponibilidad: <strong>${service.availability}%</strong>
                    </div>
                    <div style="font-size: 0.9rem;">
                        Usuarios: <strong>${service.users}</strong>
                    </div>
                </div>
            `).join('');
        }

        function renderCharts() {
            drawDonutChart();
            drawLineChart();
        }

        function drawDonutChart() {
            const canvas = document.getElementById('donutChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = [23, 15, 8, 12];
            const colors = ['#f44336', '#ff9800', '#4caf50', '#2196f3'];
            const labels = ['Cr√≠tico', 'Alto', 'Medio', 'Bajo'];
            const total = data.reduce((a, b) => a + b, 0);
            
            let currentAngle = -Math.PI / 2;
            
            data.forEach((value, index) => {
                const sliceAngle = (value / total) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[index];
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * radius * 1.3;
                const labelY = centerY + Math.sin(labelAngle) * radius * 1.3;
                
                ctx.fillStyle = colors[index];
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${labels[index]}: ${value}`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.6, 0, 2 * Math.PI);
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg-card');
            ctx.fill();
        }

        function drawLineChart() {
            const canvas = document.getElementById('lineChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            const data = Array.from({length: 12}, () => Math.random() * 30 + 10);
            const max = Math.max(...data);
            const stepX = (width - padding * 2) / (data.length - 1);
            
            ctx.strokeStyle = '#2a6fdf';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = padding + index * stepX;
                const y = height - padding - (value / max) * (height - padding * 2);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
                
                ctx.fillStyle = '#2a6fdf';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            ctx.strokeStyle = '#2a6fdf';
            ctx.stroke();
            
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            for (let i = 0; i < 12; i++) {
                ctx.fillText(`M${i + 1}`, padding + i * stepX, height - 10);
            }
        }

        function startAutoUpdate() {
            updateInterval = setInterval(() => {
                updateDynamicData();
                renderAllComponents();
                lastUpdateTime = Date.now();
            }, 5000);
        }

        function updateDynamicData() {
            dataStore.kpis = dataStore.kpis.map(kpi => {
                let newValue = kpi.value;
                const variation = (Math.random() - 0.5) * 2;
                
                if (kpi.unit === '%') {
                    newValue = Math.max(0, Math.min(100, kpi.value + variation * 0.1));
                } else if (kpi.unit === 'h') {
                    newValue = Math.max(0.5, kpi.value + variation * 0.1);
                } else if (kpi.unit === '/5') {
                    newValue = Math.max(1, Math.min(5, kpi.value + variation * 0.05));
                } else {
                    newValue = Math.max(0, kpi.value + Math.floor(variation));
                }
                
                const oldValue = kpi.value;
                const trend = newValue > oldValue ? 'up' : newValue < oldValue ? 'down' : 'neutral';
                
                return { ...kpi, value: Math.round(newValue * 100) / 100, trend };
            });
            
            if (Math.random() > 0.8) {
                updateAlertBanner();
            }
        }

        function updateAlertBanner() {
            const alerts = [
                { title: 'Sistema Operativo', message: 'Todos los servicios funcionando correctamente' },
                { title: 'Mantenimiento Programado', message: 'Actualizaci√≥n de firewall ma√±ana 02:00 AM' },
                { title: 'Alto Uso de CPU', message: 'Servidor DB01 al 85% de capacidad' },
                { title: 'Backup Exitoso', message: 'Respaldo completado satisfactoriamente' }
            ];
            
            const alert = getRandomItem(alerts);
            document.getElementById('alertTitle').textContent = alert.title + ':';
            document.getElementById('alertMessage').textContent = alert.message;
        }

        function showKPIDetail(id) {
            const kpi = dataStore.kpis.find(k => k.id === id);
            if (!kpi) return;
            
            openModal('Detalle de KPI', `
                <h3>${kpi.icon} ${kpi.title}</h3>
                <div style="font-size: 3rem; font-weight: bold; color: var(--primary-light); text-align: center; margin: 2rem 0;">
                    ${kpi.value}${kpi.unit}
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem;">
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Tendencia</div>
                        <div style="font-size: 1.5rem;">${kpi.trend === 'up' ? 'üìà Ascendente' : kpi.trend === 'down' ? 'üìâ Descendente' : '‚û°Ô∏è Estable'}</div>
                    </div>
                    <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Estado</div>
                        <div style="font-size: 1.5rem; color: var(--success);">‚óè Activo</div>
                    </div>
                </div>
                <p style="margin-top: 2rem; color: var(--text-secondary);">
                    Este KPI se actualiza autom√°ticamente cada 5 segundos con datos en tiempo real del sistema de gesti√≥n de servicios TI.
                </p>
            `);
        }

        function dismissAlert() {
            alert('‚úÖ Alerta marcada como le√≠da');
        }

        function exportData() {
            alert('‚úÖ Exportaci√≥n completada. Archivo: datos_' + new Date().toISOString().split('T')[0] + '.xlsx');
        }

        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('genericModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('genericModal').classList.remove('active');
        }

        document.getElementById('genericModal').addEventListener('click', (e) => {
            if (e.target.id === 'genericModal') {
                closeModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                renderCharts();
            }, 250);
        });

        console.log('%cüéØ PEIGSTI - TechSolutions S.A.', 'font-size: 20px; font-weight: bold; color: #2a6fdf;');
        console.log('%cPlataforma Ejecutiva Integral de Gesti√≥n de Servicios TI', 'font-size: 14px; color: #666;');
        console.log('%cISO/IEC 20000-1:2018 Certified System', 'font-size: 12px; color: #4caf50;');
    </script>
</body>
</html>
